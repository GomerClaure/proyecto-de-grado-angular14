<app-nav></app-nav>
<div class="d-flex justify-content-center align-items-center fondo" style="min-height: 100vh;">
  <div class="container p-4" style="background-color: white; border-radius: 10px; max-width: 500px;">
    <h2 class="text-center mb-4">Restablecer Contraseña</h2>
    <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" style="overflow-y: auto; max-height: 80vh;" novalidate>
      <!-- Contraseña actual (solo si no hay token) -->
      <div class="form-group" *ngIf="token === ''">
        <label for="currentPassword">Contraseña actual</label>
        <input type="password" formControlName="currentPassword" id="currentPassword" class="form-control"
          [ngClass]="{
            'is-invalid': resetPasswordForm.get('currentPassword')?.invalid && resetPasswordForm.get('currentPassword')?.touched,
            'is-valid': resetPasswordForm.get('currentPassword')?.valid && resetPasswordForm.get('currentPassword')?.touched
          }" />
        <div *ngIf="resetPasswordForm.get('currentPassword')?.invalid && resetPasswordForm.get('currentPassword')?.touched"
          class="invalid-feedback">
          La contraseña actual es requerida.
        </div>
      </div>

      <!-- Nueva contraseña -->
      <div class="form-group">
        <label for="newPassword">Nueva contraseña</label>
        <input type="password" formControlName="newPassword" id="newPassword" class="form-control" 
          [ngClass]="{
            'is-invalid': resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched || resetPasswordForm.errors?.['mismatch'],
            'is-valid': resetPasswordForm.get('newPassword')?.valid && !resetPasswordForm.errors?.['mismatch'] && resetPasswordForm.get('newPassword')?.touched
          }" />
        <div *ngIf="resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched"
          class="invalid-feedback">
          La nueva contraseña es requerida y debe tener al menos 8 caracteres.
        </div>
      </div>
      
      <div class="form-group">
        <label for="confirmPassword">Confirmar nueva contraseña</label>
        <input type="password" formControlName="confirmPassword" id="confirmPassword" class="form-control"
          [ngClass]="{
            'is-invalid': (resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched) || resetPasswordForm.errors?.['mismatch'],
            'is-valid': resetPasswordForm.get('confirmPassword')?.valid && !resetPasswordForm.errors?.['mismatch'] && resetPasswordForm.get('confirmPassword')?.touched
          }" />
        <div *ngIf="resetPasswordForm.errors?.['mismatch'] && (resetPasswordForm.get('confirmPassword')?.touched || resetPasswordForm.get('newPassword')?.touched)"
          class="invalid-feedback">
          Las contraseñas no coinciden.
        </div>
      </div>

      <button type="submit" class="btn btn-primary w-100 mt-3" [disabled]="resetPasswordForm.invalid">Restablecer contraseña</button>

    </form>
  </div>
</div>
